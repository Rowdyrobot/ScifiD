<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport"  content="text/html;charset=utf-8; width=device-width, initial-scale=1" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<title>Science Fiction Database</title>
<script src="https://kit.fontawesome.com/95cdfa4f7c.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="assets/css/main.css">
<style>
/*try it here first*/
</style>
</head>
<body>

<div class="navbar">
	<a href="#home">ScifiD</a>
	<a href="#news" class="favorites"><i class="fa fa-heart"></i><sup class="fave-count">0</sup></a>
</div>

<div class="main">
	<h1>Star Wars People</h1>
	<h2>With you, may the force be</h2>
	<p><input id="txtSearch" type="text" placeholder="Search People"><button onclick="searchPeople()">Search</button></p>
	<div id="resultsTable"></div>
	<a href="javascript:prevPage()" id="btnPrev">&lt; Prev</a>
	<a href="javascript:nextPage()" id="btnNext">Next &gt;</a>
	pg. <span id="pageNums"></span>
</div>

<script>

var currentPage = 1;
var recordsPerPage = 10;
var totalPages = 0;
var baseURL = "https://swapi.co/api/people/";
document.getElementById("txtSearch").value = "";
var searchValue = "";
GetData(baseURL);

function GetData(url) {
//grab the swapi people data
fetch(url)
.then(response => response.json())
.then(data => {
  //build swapi people table
  CreatePeople(data);
})
.catch(error => console.error(error))
}

function CreatePeople(data) {	
	var btnNext = document.getElementById("btnNext");
    var btnPrev = document.getElementById("btnPrev");
    var pageNums = document.getElementById("pageNums");
	var divResults = document.getElementById("resultsTable");
	var peopleCount = data.results.length;
	var totalCount = data.count;
	totalPages= Math.ceil(totalCount / recordsPerPage);  
  
	//get the header values from the results
	var headVal = [];
	for (var i = 0; i < peopleCount; i++) {
		for (var key in data.results[i]) {
			if (headVal.indexOf(key) === -1) {
				if (key === "name" || key === "birth_year" || key === "homeworld") {
					headVal.push(key);
				}
			}
		}
	}
	
	//calibrate pageNums
	if (pageNums < 1) pageNums = 1;
    if (pageNums > totalPages) currentPage = totalPages;
    pageNums.innerHTML = currentPage + "/" + totalPages;
	if (currentPage == 1) {
        btnPrev.style.visibility = "hidden";
    } else {
        btnPrev.style.visibility = "visible";
    }

    if (currentPage == totalPages) {
        btnNext.style.visibility = "hidden";
    } else {
        btnNext.style.visibility = "visible";
    }
	
	//create the header row; handle pagination
	divResults.innerHTML = "";
	var resultsTable = document.createElement("table");
	var tr = resultsTable.insertRow(-1);
	for (var i = 0; i < headVal.length; i++) {
		var th = document.createElement("th");
		th.innerHTML = headVal[i];
		tr.appendChild(th);
	}
	
	//put all the values into the right columns
	for (var i = 0; i < peopleCount; i++) {
		tr = resultsTable.insertRow(-1);
		for (var j = 0; j < headVal.length; j++) {
			var dataField = tr.insertCell(-1);
			dataField.innerHTML = data.results[i][headVal[j]];
		}
	}
	
	//stuff all of that into the div
	divResults.innerHTML = "";
	divResults.appendChild(resultsTable);
}

function prevPage()
{
    if (currentPage > 1) {
        currentPage--;
		var url = baseURL + "?page=" + currentPage + "&search=" + searchValue;
        GetData(url);
    }
}

function nextPage()
{
    if (currentPage < totalPages) {
        currentPage++;
		var url = baseURL + "?page=" + currentPage + "&search=" + searchValue;
        GetData(url);
    }
}

function searchPeople() {	
	searchValue = document.getElementById("txtSearch").value;
	var url = baseURL + "?search=" + searchValue;
	currentPage = 1;
    GetData(url);
}

</script>
</body>
</html>